SET SERVEROUTPUT ON
SET VERIFY OFF

ACCEPT NOM_ PROMPT "entrez le nom : "
ACCEPT PRENOM_ PROMPT "entrez le prenom : "
ACCEPT TELEPHONE_ PROMPT "entrez le telephone : "
ACCEPT NO_RUE_ PROMPT "entrez NO rue : "
ACCEPT NOM_RUE_ PROMPT "entrez NOM rue : "
ACCEPT VILLE_ PROMPT "entrez la ville  : "
ACCEPT PROVINCE_ PROMPT "entrez la province : "
ACCEPT PAYS_ PROMPT "entrez le pays : "
ACCEPT CODEPOSTAL_ PROMPT "entrez le code postal : "


DECLARE
    INTEGRITE EXCEPTION;
    TLEPHONE_TROP_PETIT EXCEPTION;
    PRAGMA EXCEPTION_INIT(INTEGRITE,-2291);
    TELEPHONE_MODIFIER VARCHAR2(10);
BEGIN
    TELEPHONE_MODIFIER := '&TELEPHONE_';
    IF LENGTH(TELEPHONE_MODIFIER) = 7 THEN

        IF UPPER('&VILLE_') = 'MONTREAL' THEN
        TELEPHONE_MODIFIER := '514' || TELEPHONE_MODIFIER;
        ELSIF UPPER('&VILLE_') = 'LAVAL' THEN
        TELEPHONE_MODIFIER := '450' || TELEPHONE_MODIFIER;
        ELSIF UPPER('&VILLE_') = 'LONGUEUIL' THEN
        TELEPHONE_MODIFIER := '450' || TELEPHONE_MODIFIER;
        ELSIF UPPER('&VILLE_') = 'QUEBEC' THEN
        TELEPHONE_MODIFIER := '418' || TELEPHONE_MODIFIER;
        ELSE
        TELEPHONE_MODIFIER := '000' || TELEPHONE_MODIFIER;
        END IF;

    ELSIF LENGTH(TELEPHONE_MODIFIER) != 10 THEN
        RAISE TLEPHONE_TROP_PETIT;
    END IF;

        INSERT INTO DD_CLIENT VALUES(CONCAT(CONCAT(SUBSTR('&NOM_',1,2) , SUBSTR('&PRENOM_',1,1)), SUBSTR(TELEPHONE_MODIFIER,7,10)),'&NOM_','&PRENOM_',
        '&NO_RUE_','&NOM_RUE_','&VILLE_','&PROVINCE_','&PAYS_','&CODEPOSTAL_',TELEPHONE_MODIFIER);



EXCEPTION 
    WHEN DUP_VAL_ON_INDEX THEN 
    DBMS_OUTPUT.PUT_LINE('LE NUMCLIENT EXISTE DEJA');
    WHEN TLEPHONE_TROP_PETIT THEN 
    DBMS_OUTPUT.PUT_LINE('LE NUMERO DE TELEPHONE N''A PAS ETE INSCRIT DANS LE BON FORMAT');
    WHEN OTHERS THEN 
    DBMS_OUTPUT.PUT_LINE('UNE ERREUR S''EST PRODUITE');

END;
/

SET VERIFY ON
@C:\Users\usager\Desktop\base\PROJET_FINAL2\menu.sql