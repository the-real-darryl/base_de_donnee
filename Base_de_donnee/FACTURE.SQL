SET SERVEROUTPUT ON
SET VERIFY OFF
ACCEPT NUMCLIENT_ PROMPT "Enter le numero de client: "
ACCEPT DATE_ PROMPT "Enter la date en format 'YY/MM/DD': "

DECLARE
	PRIX_ITEM_REGROUPER NUMBER := 0;
	TAXE_ITEM_REGROUPER NUMBER := 0;
	TAXE_TOTALE NUMBER := 0;
	PRIX_TOTALE NUMBER := 0;

	CURSOR REQUETE_ IS 
	SELECT NUMCLIENT, QUANTITEVENDUE, PRIXVENTE FROM DD_VENTECLIENT 
			WHERE NUMCLIENT = '&NUMCLIENT_' AND DATEVENTE = TO_DATE('&DATE_','YY/MM/DD');
	ITEM DD_VENTECLIENT%ROWTYPE;

BEGIN
	DBMS_OUTPUT.PUT_LINE('---------------FACTURE---------------');
	DBMS_OUTPUT.PUT_LINE('CLIENT : '||'&NUMCLIENT_'||'	DATE : '||'&DATE_');
	DBMS_OUTPUT.PUT_LINE('NUMERO ITEM'||'         '||'QUANTITE'||'               '||'PRIX UNITAIRE'||'   '||'PRIX PAR TYPE ITEM'||'  '||'TAXE PAR TYPE ITEM');
	DBMS_OUTPUT.PUT_LINE('-------------------------------------');	

            FOR ITEM IN(SELECT NUMCLIENT,QUANTITEVENDUE,PRIXVENTE FROM DD_VENTECLIENT 
			WHERE NUMCLIENT = '&NUMCLIENT_' AND DATEVENTE = TO_DATE('&DATE_','YY/MM/DD')) LOOP
                			PRIX_ITEM_REGROUPER := TAXEPACKAGE.COUTVENTE(ITEM.QUANTITEVENDUE,ITEM.PRIXVENTE);
                            PRIX_TOTALE := PRIX_TOTALE + PRIX_ITEM_REGROUPER;

                            TAXE_ITEM_REGROUPER := TAXEPACKAGE.TAXE(PRIX_ITEM_REGROUPER);
                            TAXE_TOTALE := TAXE_TOTALE + TAXE_ITEM_REGROUPER;
                            DBMS_OUTPUT.PUT_LINE(ITEM.NUMCLIENT||'         '||ITEM.QUANTITEVENDUE||'               '||ITEM.PRIXVENTE||'   '||PRIX_ITEM_REGROUPER||'  '||TAXE_ITEM_REGROUPER);
            END LOOP;
	DBMS_OUTPUT.PUT_LINE('---------------------------------------------');	
	DBMS_OUTPUT.PUT_LINE('TOTAL AVANT TAXE: '||PRIX_TOTALE);
	DBMS_OUTPUT.PUT_LINE('TAXE:    '||TAXE_TOTALE);
	DBMS_OUTPUT.PUT_LINE('TOTAL:    '||(PRIX_TOTALE + TAXE_TOTALE));	
END;
/
SET VERIFY ON


PROMPT Appuyer sur une touche ...
PAUSE
@C:\Users\usager\Desktop\base\PROJET_FINAL2\menu.sql

